<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Test - Step8 Complete</title>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: linear-gradient(135deg, #0088FF 0%, #00468E 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .hero {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }
        
        .hero h1 {
            color: #0088FF;
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        .hero p {
            color: #6c757d;
            font-size: 18px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .test-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }
        
        .test-card h3 {
            color: #0088FF;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-card h3 i {
            font-size: 24px;
        }
        
        .btn {
            background: linear-gradient(135deg, #0088FF 0%, #0068CC 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            width: 100%;
            margin: 5px 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(0, 136, 255, 0.4);
        }
        
        .btn.success { background: linear-gradient(135deg, #28A745 0%, #20C997 100%); }
        .btn.warning { background: linear-gradient(135deg, #FFC107 0%, #E0A800 100%); }
        .btn.danger { background: linear-gradient(135deg, #DC3545 0%, #C82333 100%); }
        
        .status-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 8px 0;
        }
        
        .badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .badge.ok { background: #28A745; color: white; }
        .badge.error { background: #DC3545; color: white; }
        .badge.warning { background: #FFC107; color: black; }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero">
            <h1>üéØ Step8 Final Test Suite</h1>
            <p>Ki·ªÉm tra to√†n di·ªán - T·∫•t c·∫£ t√≠nh nƒÉng ƒë√£ ho√†n thi·ªán</p>
        </div>

        <div class="test-grid">
            <!-- Card 1: Quick Test -->
            <div class="test-card">
                <h3><i class="fas fa-bolt"></i> Quick Test</h3>
                <p style="color: #6c757d; margin-bottom: 15px;">Test nhanh v·ªõi 1 click</p>
                <button class="btn success" onclick="quickTest()">
                    <i class="fas fa-rocket"></i>
                    Ch·∫°y Quick Test
                </button>
                <button class="btn" onclick="window.open('/shinhanbank/pages/vi/step8.html', '_blank')">
                    <i class="fas fa-external-link-alt"></i>
                    Xem Step8
                </button>
            </div>

            <!-- Card 2: Debug -->
            <div class="test-card">
                <h3><i class="fas fa-bug"></i> Debug Tools</h3>
                <p style="color: #6c757d; margin-bottom: 15px;">C√¥ng c·ª• debug chuy√™n s√¢u</p>
                <button class="btn warning" onclick="window.open('/shinhanbank/pages/vi/DEBUG-STEP8.html', '_blank')">
                    <i class="fas fa-search"></i>
                    Debug Tool
                </button>
                <button class="btn" onclick="window.open('/shinhanbank/pages/vi/AUTO-FIX-STEP8.html', '_blank')">
                    <i class="fas fa-wrench"></i>
                    Auto-Fix
                </button>
            </div>

            <!-- Card 3: Visual Demo -->
            <div class="test-card">
                <h3><i class="fas fa-eye"></i> Visual Demo</h3>
                <p style="color: #6c757d; margin-bottom: 15px;">Xem countdown & progress bar</p>
                <button class="btn success" onclick="window.open('/shinhanbank/pages/vi/DEMO-STEP8.html', '_blank')">
                    <i class="fas fa-play-circle"></i>
                    M·ªü Demo
                </button>
            </div>
        </div>

        <!-- Status Panel -->
        <div class="status-panel">
            <h2 style="color: #0088FF; margin-bottom: 20px;">
                <i class="fas fa-chart-line"></i>
                System Status
            </h2>
            <div id="statusContainer"></div>
            
            <button class="btn success" onclick="runFullTest()" style="margin-top: 20px;">
                <i class="fas fa-check-double"></i>
                Run Full System Test
            </button>
        </div>
    </div>

    <script>
        function updateStatus() {
            const container = document.getElementById('statusContainer');
            const checks = [
                {
                    name: 'userData exists',
                    test: () => !!localStorage.getItem('userData'),
                    icon: 'fa-database'
                },
                {
                    name: 'CryptoJS loaded',
                    test: () => typeof CryptoJS !== 'undefined',
                    icon: 'fa-lock'
                },
                {
                    name: 'userData can decrypt',
                    test: () => {
                        try {
                            const enc = localStorage.getItem('userData');
                            if (!enc) return false;
                            const dec = CryptoJS.AES.decrypt(enc, 'shinhan-secret-key').toString(CryptoJS.enc.Utf8);
                            return !!JSON.parse(dec);
                        } catch { return false; }
                    },
                    icon: 'fa-key'
                },
                {
                    name: 'fullName field exists',
                    test: () => {
                        try {
                            const enc = localStorage.getItem('userData');
                            const dec = CryptoJS.AES.decrypt(enc, 'shinhan-secret-key').toString(CryptoJS.enc.Utf8);
                            const data = JSON.parse(dec);
                            return !!data.fullName;
                        } catch { return false; }
                    },
                    icon: 'fa-user'
                },
                {
                    name: 'loanAmount field exists',
                    test: () => {
                        try {
                            const enc = localStorage.getItem('userData');
                            const dec = CryptoJS.AES.decrypt(enc, 'shinhan-secret-key').toString(CryptoJS.enc.Utf8);
                            const data = JSON.parse(dec);
                            return !!data.loanAmount;
                        } catch { return false; }
                    },
                    icon: 'fa-money-bill-wave'
                },
                {
                    name: 'disbursementEndTime set',
                    test: () => !!localStorage.getItem('disbursementEndTime'),
                    icon: 'fa-clock'
                }
            ];
            
            let html = '';
            let passCount = 0;
            
            checks.forEach(check => {
                const passed = check.test();
                if (passed) passCount++;
                
                html += `
                    <div class="status-item">
                        <span>
                            <i class="fas ${check.icon}" style="color: ${passed ? '#28A745' : '#DC3545'}; margin-right: 10px;"></i>
                            ${check.name}
                        </span>
                        <span class="badge ${passed ? 'ok' : 'error'}">
                            ${passed ? '‚úÖ OK' : '‚ùå Failed'}
                        </span>
                    </div>
                `;
            });
            
            const percentage = Math.round((passCount / checks.length) * 100);
            const statusColor = percentage === 100 ? '#28A745' : percentage >= 50 ? '#FFC107' : '#DC3545';
            
            html = `
                <div style="background: ${statusColor}; color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
                    <h3 style="margin: 0; font-size: 24px;">${percentage}% Ready</h3>
                    <p style="margin: 5px 0 0 0;">${passCount}/${checks.length} checks passed</p>
                </div>
            ` + html;
            
            container.innerHTML = html;
        }
        
        function quickTest() {
            alert('üöÄ Running Quick Test...\n\nS·∫Ω:\n1. Ki·ªÉm tra userData\n2. T·∫°o data n·∫øu thi·∫øu\n3. M·ªü Step8');
            
            const hasData = localStorage.getItem('userData');
            
            if (!hasData) {
                createTestData();
            }
            
            setTimeout(() => {
                window.open('/shinhanbank/pages/vi/step8.html', '_blank');
            }, 500);
        }
        
        function runFullTest() {
            updateStatus();
            alert('‚úÖ Full System Test Complete!\n\nXem k·∫øt qu·∫£ ·ªü panel "System Status" ph√≠a tr√™n.');
        }
        
        function createTestData() {
            const userData = {
                fullName: 'Nguy·ªÖn VƒÉn Test',
                loanAmount: '50000000',
                monthlyPayment: 4441.67,
                loanTerm: '12',
                interestRate: 12.0,
                currentStep: 8,
                timestamp: new Date().toISOString()
            };
            
            const encrypted = CryptoJS.AES.encrypt(JSON.stringify(userData), 'shinhan-secret-key').toString();
            localStorage.setItem('userData', encrypted);
            
            const endTime = Date.now() + (24 * 60 * 60 * 1000);
            localStorage.setItem('disbursementEndTime', endTime.toString());
            
            updateStatus();
        }
        
        // Auto update status
        window.addEventListener('DOMContentLoaded', updateStatus);
        setInterval(updateStatus, 5000);
    </script>
</body>
</html>


